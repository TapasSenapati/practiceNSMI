<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Common Derivatives MCQ Interactive Quiz</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 30px;
      background: #f5f8fa;
      color: #333;
    }

    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      text-align: center;
    }

    #subtitle {
      text-align: center;
      margin-bottom: 30px;
      color: #5c6f82;
    }

    #controls,
    #filters {
      max-width: 1000px;
      margin: 0 auto 20px auto;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    #filters input {
      flex: 1 1 280px;
      padding: 10px 14px;
      border: 2px solid #d0dae6;
      border-radius: 6px;
      font-size: 15px;
    }

    #quiz {
      max-width: 1000px;
      margin: 0 auto;
    }

    .question {
      background: #fff;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }

    .question-number {
      font-size: 14px;
      color: #7d8da1;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .question-text {
      font-weight: bold;
      font-size: 17px;
      margin-bottom: 15px;
      line-height: 1.5;
      color: #1f2a37;
    }

    .options {
      margin: 15px 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .options button {
      text-align: left;
      padding: 12px 15px;
      border: 2px solid #d8e1ec;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.2s ease;
    }

    .options button:hover:not(:disabled) {
      border-color: #3084e0;
      background: #f0f7ff;
    }

    .options button:disabled {
      cursor: default;
      opacity: 0.95;
    }

    .feedback {
      margin-top: 8px;
      font-weight: bold;
      font-size: 15px;
    }

    .feedback.correct {
      color: #27ae60;
    }

    .feedback.incorrect {
      color: #e74c3c;
    }

    .explanation {
      background: #f0f4ff;
      padding: 12px 15px;
      margin-top: 10px;
      border-radius: 6px;
      border-left: 4px solid #3084e0;
      font-size: 14px;
      line-height: 1.6;
      color: #444;
      display: none;
    }

    #scoreDisplay {
      max-width: 1000px;
      margin: 20px auto;
      padding: 18px;
      background: #fff;
      border-radius: 8px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #27ae60;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: none;
    }

    button.primary {
      padding: 12px 26px;
      font-size: 15px;
      border: none;
      border-radius: 6px;
      background: #3084e0;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button.primary:hover {
      background: #2563c1;
    }

    button.secondary {
      padding: 12px 26px;
      font-size: 15px;
      border: 2px solid #d0dae6;
      border-radius: 6px;
      background: #fff;
      color: #2c3e50;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button.secondary:hover {
      border-color: #3084e0;
      color: #3084e0;
    }

    #progressBarWrapper {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto 20px auto;
      background: #e5ebf3;
      border-radius: 999px;
      height: 14px;
      overflow: hidden;
    }

    #progressBar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #3084e0, #2bd0c9);
      transition: width 0.2s ease;
    }

    #progressLabel {
      text-align: center;
      margin-bottom: 12px;
      color: #4e5d73;
      font-size: 14px;
    }

    #emptyState {
      text-align: center;
      padding: 60px 20px;
      color: #7d8da1;
      font-size: 18px;
      display: none;
    }

    @media (max-width: 640px) {
      body {
        padding: 18px;
      }

      .question {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>NISM Series XIII - Derivatives Quiz</h1>
  <p id="subtitle">Practice the first 100 MCQs from the Last Day Revision Test</p>

  <div id="filters">
    <input id="searchInput" type="text" placeholder="Search question, options or explanation..." />
  </div>

  <div id="controls">
    <button class="primary" id="shuffleBtn">Shuffle Questions</button>
    <button class="secondary" id="resetBtn">Reset Quiz</button>
    <button class="primary" id="scoreBtn">Show Score</button>
  </div>

  <div id="progressLabel">0 / 0 questions answered</div>
  <div id="progressBarWrapper">
    <div id="progressBar"></div>
  </div>

  <div id="quiz"></div>
  <div id="emptyState">No questions match your search. Try another keyword.</div>
  <div id="scoreDisplay"></div>

  <script>
    const quizContainer = document.getElementById('quiz');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const searchInput = document.getElementById('searchInput');
    const progressLabel = document.getElementById('progressLabel');
    const progressBar = document.getElementById('progressBar');
    const emptyState = document.getElementById('emptyState');

    const shuffleBtn = document.getElementById('shuffleBtn');
    const resetBtn = document.getElementById('resetBtn');
    const scoreBtn = document.getElementById('scoreBtn');

    let allQuestions = [];
    let visibleQuestions = [];
    let userAnswers = [];

    fetch('derivatives_quiz_data.json')
      .then(response => response.json())
      .then(data => {
        allQuestions = data.map(q => ({
          ...q,
          explanation: q.explanation || 'No explanation provided in the source file.'
        }));
        visibleQuestions = [...allQuestions];
        userAnswers = Array(visibleQuestions.length).fill(null);
        renderQuiz();
      })
      .catch(() => {
        quizContainer.innerHTML = '<p>Unable to load the question bank. Make sure the JSON file is available.</p>';
      });

    function renderQuiz() {
      quizContainer.innerHTML = '';
      scoreDisplay.style.display = 'none';

      if (!visibleQuestions.length) {
        emptyState.style.display = 'block';
        progressLabel.textContent = '0 / 0 questions answered';
        progressBar.style.width = '0%';
        return;
      }

      emptyState.style.display = 'none';

      visibleQuestions.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question';

        const qNumber = document.createElement('div');
        qNumber.className = 'question-number';
        qNumber.textContent = `Question ${q.number}`;

        const qText = document.createElement('div');
        qText.className = 'question-text';
        qText.textContent = q.text;

        const optionsDiv = document.createElement('div');
        optionsDiv.className = 'options';

        q.options.forEach((option, optIndex) => {
          const btn = document.createElement('button');
          btn.textContent = option;
          btn.disabled = userAnswers[index] !== null;
          btn.addEventListener('click', () => handleOptionClick(index, optIndex, optionsDiv));
          optionsDiv.appendChild(btn);
        });

        const feedbackDiv = document.createElement('div');
        feedbackDiv.id = `feedback_${index}`;
        feedbackDiv.className = 'feedback';

        const explanationDiv = document.createElement('div');
        explanationDiv.id = `explanation_${index}`;
        explanationDiv.className = 'explanation';
        explanationDiv.textContent = q.explanation;

        questionDiv.appendChild(qNumber);
        questionDiv.appendChild(qText);
        questionDiv.appendChild(optionsDiv);
        questionDiv.appendChild(feedbackDiv);
        questionDiv.appendChild(explanationDiv);

        quizContainer.appendChild(questionDiv);
      });

      updateProgress();
    }

    function handleOptionClick(qIndex, chosenIndex, optionsDiv) {
      if (userAnswers[qIndex] !== null) {
        return;
      }

      userAnswers[qIndex] = chosenIndex;
      const question = visibleQuestions[qIndex];

      const buttons = optionsDiv.querySelectorAll('button');
      buttons.forEach((btn, idx) => {
        btn.disabled = true;
        if (idx === question.correctIndex) {
          btn.style.backgroundColor = '#27ae60';
          btn.style.borderColor = '#27ae60';
          btn.style.color = '#fff';
        } else if (idx === chosenIndex) {
          btn.style.backgroundColor = '#e74c3c';
          btn.style.borderColor = '#e74c3c';
          btn.style.color = '#fff';
        }
      });

      const feedbackDiv = document.getElementById(`feedback_${qIndex}`);
      const explanationDiv = document.getElementById(`explanation_${qIndex}`);

      if (chosenIndex === question.correctIndex) {
        feedbackDiv.textContent = '✓ Correct!';
        feedbackDiv.className = 'feedback correct';
      } else {
        feedbackDiv.textContent = '✗ Incorrect!';
        feedbackDiv.className = 'feedback incorrect';
      }

      explanationDiv.style.display = 'block';
      updateProgress();
    }

    function updateProgress() {
      const answered = userAnswers.filter(value => value !== null).length;
      const total = userAnswers.length || 0;
      progressLabel.textContent = `${answered} / ${total} questions answered`;
      const percent = total ? (answered / total) * 100 : 0;
      progressBar.style.width = `${percent}%`;
    }

    function shuffleQuestions() {
      for (let i = visibleQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [visibleQuestions[i], visibleQuestions[j]] = [visibleQuestions[j], visibleQuestions[i]];
      }
      userAnswers = Array(visibleQuestions.length).fill(null);
      renderQuiz();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetQuiz() {
      userAnswers = Array(visibleQuestions.length).fill(null);
      renderQuiz();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showScore() {
      if (!visibleQuestions.length) {
        return;
      }
      let score = 0;
      visibleQuestions.forEach((question, index) => {
        if (userAnswers[index] === question.correctIndex) {
          score += 1;
        }
      });
      scoreDisplay.textContent = `Your Score: ${score} / ${visibleQuestions.length}`;
      scoreDisplay.style.display = 'block';
      scoreBtn.textContent = 'Score Updated';
      setTimeout(() => (scoreBtn.textContent = 'Show Score'), 2000);
    }

    function handleSearch() {
      const term = searchInput.value.trim().toLowerCase();
      if (!term) {
        visibleQuestions = [...allQuestions];
      } else {
        visibleQuestions = allQuestions.filter(question => {
          return (
            question.text.toLowerCase().includes(term) ||
            question.options.some(opt => opt.toLowerCase().includes(term)) ||
            (question.explanation && question.explanation.toLowerCase().includes(term))
          );
        });
      }
      userAnswers = Array(visibleQuestions.length).fill(null);
      renderQuiz();
    }

    shuffleBtn.addEventListener('click', shuffleQuestions);
    resetBtn.addEventListener('click', resetQuiz);
    scoreBtn.addEventListener('click', showScore);
    searchInput.addEventListener('input', handleSearch);
  </script>
</body>
</html>

